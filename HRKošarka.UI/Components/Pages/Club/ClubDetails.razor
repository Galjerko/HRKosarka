@page "/clubs/{id:guid}"
@using HRKošarka.UI.Services.Base

<PageTitle>Club Details - Basketball Management</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="details-container">
    @if (_isLoading)
    {
        <div class="loading-state">
            <MudProgressCircular Size="Size.Large" Indeterminate="true" />
            <MudText Typo="Typo.h6">Loading club details...</MudText>
        </div>
    }
    else if (_club != null)
    {
        <MudPaper Class="details-paper" Elevation="2">

            <div class="details-actions-row">
                <div class="details-actions-group">
                    <AuditHistory DateCreated="@_club.DateCreated"
                                  DateModified="@_club.DateModified"
                                  DateDeleted="@_club.DateDeleted"
                                  CreatedBy="@_club.CreatedBy"
                                  ModifiedBy="@_club.ModifiedBy"
                                  DeletedBy="@_club.DeletedBy" />

                    <AuthorizeView Roles="Administrator,ClubManager">
                        <Authorized>
                            <MudButton Variant="Variant.Outlined"
                                       Color="Color.Primary"
                                       StartIcon="@Icons.Material.Filled.Edit"
                                       OnClick="@(() => NavigationManager.NavigateTo($"/clubs/edit/{Id}"))"
                                       Class="action-btn details-action-btn">
                                Edit
                            </MudButton>
                            @if (_club.IsActive)
                            {
                                <MudButton Variant="Variant.Outlined"
                                           Color="Color.Warning"
                                           StartIcon="@Icons.Material.Filled.Pause"
                                           OnClick="DeactivateClub"
                                           Disabled="@_isProcessing"
                                           Class="action-btn details-action-btn">
                                    Deactivate
                                </MudButton>
                            }
                        </Authorized>
                    </AuthorizeView>
                    <AuthorizeView Roles="Administrator">
                        <Authorized>
                            <MudButton Variant="Variant.Outlined"
                                       Color="Color.Error"
                                       StartIcon="@Icons.Material.Filled.Delete"
                                       OnClick="DeleteClub"
                                       Disabled="@_isProcessing"
                                       Class="action-btn details-action-btn">
                                Delete
                            </MudButton>
                        </Authorized>
                    </AuthorizeView>
                    <MudButton Variant="Variant.Text"
                               Color="Color.Secondary"
                               StartIcon="@Icons.Material.Filled.ArrowBack"
                               OnClick="@(() => NavigationManager.NavigateTo("/clubs"))"
                               Class="action-btn details-action-btn back-action-btn">
                        Back
                    </MudButton>
                </div>
            </div>

            <div class="details-info-row">
                <MudAvatar Size="Size.Large" Class="details-logo">
                    @if (!string.IsNullOrEmpty(_club.LogoUrl))
                    {
                        <MudImage Src="@_club.LogoUrl" Alt="@_club.Name" Style="width:100%;height:100%;object-fit:cover;border-radius:inherit;" />
                    }
                    else
                    {
                        <MudIcon Icon="@Icons.Material.Filled.Business" Size="Size.Large" />
                    }
                </MudAvatar>
                <MudText Typo="Typo.h3" Class="details-name">@_club.Name</MudText>
                <MudChip T="string"
                         Color="@(_club.IsActive ? Color.Success : Color.Error)"
                         Size="Size.Small"
                         Class="status-chip">
                    @(_club.IsActive ? "Active" : "Inactive")
                </MudChip>
            </div>

            <MudDivider Class="my-4" />

            <MudExpansionPanels Elevation="0" Class="expansion-panels">
                <MudExpansionPanel IsInitiallyExpanded="true" Class="expansion-panel">
                    <TitleContent>
                        <div class="panel-title">
                            <MudIcon Icon="@Icons.Material.Filled.Info" Class="panel-icon" />
                            <MudText Typo="Typo.h6">Basic Information</MudText>
                        </div>
                    </TitleContent>
                    <ChildContent>
                        <div class="info-grid">
                            <div class="info-row">
                                <div class="info-item">
                                    <MudText Class="info-label">Club Name</MudText>
                                    <MudText Class="info-value">@_club.Name</MudText>
                                </div>
                                <div class="info-item">
                                    <MudText Class="info-label">City</MudText>
                                    <MudText Class="info-value">@_club.City</MudText>
                                </div>
                                <div class="info-item">
                                    <MudText Class="info-label">Founded Year</MudText>
                                    <MudText Class="info-value">@_club.FoundedYear</MudText>
                                </div>
                            </div>
                            <div class="info-row">
                                <div class="info-item">
                                    <MudText Class="info-label">Status</MudText>
                                    <MudText Class="info-value" Color="@(_club.IsActive ? Color.Success : Color.Error)">
                                        @(_club.IsActive ? "Active" : $"Deactivated on {_club.DeactivateDate?.ToString("dd/MM/yyyy")}")
                                    </MudText>
                                </div>
                                <div class="info-item">
                                    <MudText Class="info-label">Venue</MudText>
                                    <MudText Class="info-value">@_club.VenueName</MudText>
                                </div>

                                <div class="info-item">
                                    <MudText Class="info-label">Venue capacity</MudText>
                                    <MudText Class="info-value">@_club.VenueCapacity</MudText>
                                </div>
                            </div>
                            <div class="info-row">
                                <div class="info-item info-item-full">
                                    <MudText Class="info-label">Description</MudText>
                                    <MudText Class="info-value">@_club.Description</MudText>
                                </div>
                            </div>
                        </div>
                    </ChildContent>
                </MudExpansionPanel>

                <MudExpansionPanel Class="expansion-panel">
                    <TitleContent>
                        <div class="panel-title">
                            <MudIcon Icon="@Icons.Material.Filled.ContactMail" Class="panel-icon" />
                            <MudText Typo="Typo.h6">Contact Information</MudText>
                        </div>
                    </TitleContent>
                    <ChildContent>
                        <div class="info-grid">
                            <div class="info-row">
                                <div class="info-item">
                                    <MudText Class="info-label">Email Address</MudText>
                                    @if (!string.IsNullOrEmpty(_club.Email))
                                    {
                                        <MudLink Href="@($"mailto:{_club.Email}")" Color="Color.Primary" Class="info-value">
                                            @_club.Email
                                        </MudLink>
                                    }
                                    else
                                    {
                                        <MudText Class="info-value"></MudText>
                                    }
                                </div>
                                <div class="info-item">
                                    <MudText Class="info-label">Phone Number</MudText>
                                    @if (!string.IsNullOrEmpty(_club.PhoneNumber))
                                    {
                                        <MudLink Href="@($"tel:{_club.PhoneNumber}")" Color="Color.Primary" Class="info-value">
                                            @_club.PhoneNumber
                                        </MudLink>
                                    }
                                    else
                                    {
                                        <MudText Class="info-value"></MudText>
                                    }
                                </div>
                                <div class="info-item">
                                    <MudText Class="info-label">Website</MudText>
                                    @if (!string.IsNullOrEmpty(_club.Website))
                                    {
                                        <MudLink Href="@_club.Website" Target="_blank" Color="Color.Primary" Class="info-value">
                                            @_club.Website
                                        </MudLink>
                                    }
                                    else
                                    {
                                        <MudText Class="info-value"></MudText>
                                    }
                                </div>
                            </div>
                        </div>
                    </ChildContent>
                </MudExpansionPanel>

                <MudExpansionPanel Class="expansion-panel">
                    <TitleContent>
                        <div class="panel-title">
                            <MudIcon Icon="@Icons.Material.Filled.LocationOn" Class="panel-icon" />
                            <MudText Typo="Typo.h6">Address Information</MudText>
                        </div>
                    </TitleContent>
                    <ChildContent>
                        <div class="info-grid">
                            <div class="info-row">
                                <div class="info-item">
                                    <MudText Class="info-label">Street Address</MudText>
                                    <MudText Class="info-value">@_club.Address</MudText>
                                </div>
                                <div class="info-item">
                                    <MudText Class="info-label">Postal Code</MudText>
                                    <MudText Class="info-value">@_club.PostalCode</MudText>
                                </div>
                                <div class="info-item">
                                    <MudText Class="info-label">Full Address</MudText>
                                    <MudText Class="info-value">
                                        @{
                                            var fullAddress = new List<string>();
                                            if (!string.IsNullOrEmpty(_club.Address)) fullAddress.Add(_club.Address);
                                            if (!string.IsNullOrEmpty(_club.City)) fullAddress.Add(_club.City);
                                            if (!string.IsNullOrEmpty(_club.PostalCode)) fullAddress.Add(_club.PostalCode);
                                        }
                                        @(fullAddress.Any() ? string.Join(", ", fullAddress) : "")
                                    </MudText>
                                </div>
                            </div>
                        </div>
                    </ChildContent>
                </MudExpansionPanel>

                <MudExpansionPanel Class="expansion-panel">
                    <TitleContent>
                        <div class="panel-title">
                            <MudIcon Icon="@Icons.Material.Filled.Groups" Class="panel-icon" />
                            <MudText Typo="Typo.h6">Teams (@_club.Teams.Count)</MudText>
                        </div>
                    </TitleContent>
                    <ChildContent>

                        <AuthorizeView Roles="Administrator,ClubManager">
                            <Authorized>
                                <MudButton Variant="Variant.Outlined"
                                           Color="Color.Primary"
                                           StartIcon="@Icons.Material.Filled.Add"
                                           OnClick="@(() => NavigationManager.NavigateTo($"/clubs/{_club.Id}/teams/create"))"
                                           Class="action-btn details-action-btn mb-4"
                                           Disabled="!_club.IsActive">
                                    Add Team
                                </MudButton>
                            </Authorized>
                        </AuthorizeView>

                        @if (_club.Teams.Any())
                        {

                            var maleTeams = _club.Teams.Where(t => t.Gender == Gender._0).ToList();
                            var femaleTeams = _club.Teams.Where(t => t.Gender == Gender._1).ToList();


                            @if (maleTeams.Any())
                            {
                                <div class="teams-section">
                                    <MudText Typo="Typo.h6" Class="teams-section-title">
                                        <MudIcon Icon="@Icons.Material.Filled.Man" Class="mr-2" />
                                        Male Teams (@maleTeams.Count)
                                    </MudText>
                                    <div class="teams-grid">
                                        @foreach (var team in maleTeams)
                                        {
                                            <MudCard Class="team-card" Elevation="1">
                                                <MudCardContent>
                                                    <div class="team-card-header">
                                                        <MudText Typo="Typo.h6" Class="team-name">@team.Name</MudText>
                                                        <MudChip T="string"
                                                                 Color="@(team.IsActive ? Color.Success : Color.Error)"
                                                                 Size="Size.Small">
                                                            @(team.IsActive ? "Active" : "Inactive")
                                                        </MudChip>
                                                    </div>
                                                    <MudText Typo="Typo.body2" Class="team-category">
                                                        @team.AgeCategoryCode
                                                    </MudText>
                                                </MudCardContent>
                                                <MudCardActions>
                                                    <MudButton Variant="Variant.Text"
                                                               Color="Color.Primary"
                                                               Size="Size.Small"
                                                               OnClick="@(() => NavigationManager.NavigateTo($"/teams/{team.Id}"))">
                                                        View Details
                                                    </MudButton>
                                                </MudCardActions>
                                            </MudCard>
                                        }
                                    </div>
                                </div>
                            }

                            @if (femaleTeams.Any())
                            {
                                <div class="teams-section @(maleTeams.Any() ? "mt-4" : "")">
                                    <MudText Typo="Typo.h6" Class="teams-section-title">
                                        <MudIcon Icon="@Icons.Material.Filled.Woman" Class="mr-2" />
                                        Female Teams (@femaleTeams.Count)
                                    </MudText>
                                    <div class="teams-grid">
                                        @foreach (var team in femaleTeams)
                                        {
                                            <MudCard Class="team-card" Elevation="1">
                                                <MudCardContent>
                                                    <div class="team-card-header">
                                                        <MudText Typo="Typo.h6" Class="team-name">@team.Name</MudText>
                                                        <MudChip T="string"
                                                                 Color="@(team.IsActive ? Color.Success : Color.Error)"
                                                                 Size="Size.Small">
                                                            @(team.IsActive ? "Active" : "Inactive")
                                                        </MudChip>
                                                    </div>
                                                    <MudText Typo="Typo.body2" Class="team-category">
                                                        @team.AgeCategoryCode
                                                    </MudText>
                                                </MudCardContent>
                                                <MudCardActions>
                                                    <MudButton Variant="Variant.Text"
                                                               Color="Color.Primary"
                                                               Size="Size.Small"
                                                               OnClick="@(() => NavigationManager.NavigateTo($"/teams/{team.Id}"))">
                                                        View Details
                                                    </MudButton>
                                                </MudCardActions>
                                            </MudCard>
                                        }
                                    </div>
                                </div>
                            }
                        }
                        else
                        {
                            <div class="no-teams-state">
                                <MudIcon Icon="@Icons.Material.Filled.Groups" Size="Size.Large" Color="Color.Tertiary" />
                                <MudText Typo="Typo.body1" Color="Color.Tertiary">No teams found for this club.</MudText>
                                <AuthorizeView Roles="Administrator,ClubManager">
                                    <Authorized>
                                        <MudButton Variant="Variant.Outlined"
                                                   Color="Color.Primary"
                                                   Disabled="!_club.IsActive"
                                                   StartIcon="@Icons.Material.Filled.Add"
                                                   OnClick="@(() => NavigationManager.NavigateTo($"/clubs/{Id}/teams/create"))">
                                            Create First Team
                                        </MudButton>
                                    </Authorized>
                                </AuthorizeView>
                            </div>
                        }
                    </ChildContent>
                </MudExpansionPanel>
            </MudExpansionPanels>
        </MudPaper>
    }
    else
    {
        <div class="error-state">
            <MudIcon Icon="@Icons.Material.Filled.ErrorOutline" Size="Size.Large" Color="Color.Error" />
            <MudText Typo="Typo.h5" Color="Color.Error">Club Not Found</MudText>
            <MudText Typo="Typo.body1">The club you're looking for doesn't exist or has been removed.</MudText>
            <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.ArrowBack"
                       OnClick="@(() => NavigationManager.NavigateTo("/clubs"))">
                Back to Clubs
            </MudButton>
        </div>
    }
</MudContainer>

<ConfirmActionDialog Visible="_showDeactivateDialog"
                     VisibleChanged="v => _showDeactivateDialog = v"
                     Title="Confirm Deactivation"
                     TitleIcon="@Icons.Material.Filled.PauseCircle"
                     TitleIconColor="Color.Warning"
                     Message="@(DeactivateMessage)"
                     SecondaryMessage="This action can be reversed later."
                     SecondaryMessageColor="Color.Warning"
                     CancelText="CANCEL"
                     CancelVariant="Variant.Outlined"
                     ConfirmText="DEACTIVATE"
                     ConfirmIcon="@Icons.Material.Filled.Pause"
                     ConfirmColor="Color.Warning"
                     ConfirmVariant="Variant.Filled"
                     IsProcessing="_isProcessing"
                     OnConfirm="ConfirmDeactivate"
                     Options="_dialogOptions" />

<ConfirmActionDialog Visible="_showDeleteDialog"
                     VisibleChanged="v => _showDeleteDialog = v"
                     Title="Confirm Deletion"
                     TitleIcon="@Icons.Material.Filled.Warning"
                     TitleIconColor="Color.Error"
                     Message="@(DeleteMessage)"
                     SecondaryMessage="This action cannot be undone!"
                     SecondaryMessageColor="Color.Error"
                     CancelText="CANCEL"
                     CancelVariant="Variant.Outlined"
                     ConfirmText="DELETE"
                     ConfirmIcon="@Icons.Material.Filled.Delete"
                     ConfirmColor="Color.Error"
                     ConfirmVariant="Variant.Filled"
                     IsProcessing="_isProcessing"
                     OnConfirm="ConfirmDelete"
                     Options="_dialogOptions" />


