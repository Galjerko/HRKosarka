@page "/teams/{id:guid}"
@using MudBlazor
@using HRKošarka.UI.Services.Base
@using HRKošarka.UI.Components.Base
@inherits HRKošarka.UI.Components.Base.PermissionBaseComponent

<PageTitle>Team Details - Basketball Management</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="details-container">
    @if (_isLoading)
    {
        <div class="loading-state">
            <MudProgressCircular Size="Size.Large" Indeterminate="true" />
            <MudText Typo="Typo.h6">Loading team details...</MudText>
        </div>
    }
    else if (_team != null)
    {
        <MudPaper Class="details-paper" Elevation="2">
            <div class="details-actions-row">
                <div class="details-actions-group">
                    <AuditHistory DateCreated="@_team.DateCreated"
                                  DateModified="@_team.DateModified"
                                  DateDeleted="@_team.DateDeleted"
                                  CreatedBy="@_team.CreatedBy"
                                  ModifiedBy="@_team.ModifiedBy"
                                  DeletedBy="@_team.DeletedBy" />

                    @if (CurrentPermissions.CanEdit)
                    {
                        <MudButton Variant="Variant.Outlined"
                                   Color="Color.Primary"
                                   StartIcon="@Icons.Material.Filled.Edit"
                                   OnClick="@(() =>
                                   {
                                       _newTeamName = _team.Name;
                                       _showRenameDialog = true;
                                   })"
                                   Class="action-btn details-action-btn">
                            Edit
                        </MudButton>

                        @if (_team.IsActive)
                        {
                            <MudButton Variant="Variant.Outlined"
                                       Color="Color.Warning"
                                       StartIcon="@Icons.Material.Filled.Pause"
                                       OnClick="DeactivateTeam"
                                       Disabled="@_isProcessing"
                                       Class="action-btn details-action-btn">
                                Deactivate
                            </MudButton>
                        }
                        else
                        {
                            <MudButton Variant="Variant.Outlined"
                                       Color="Color.Success"
                                       StartIcon="@Icons.Material.Filled.PlayArrow"
                                       OnClick="ActivateTeam"
                                       Disabled="@_isProcessing"
                                       Class="action-btn details-action-btn">
                                Activate
                            </MudButton>
                        }
                    }

                    @if (CurrentPermissions.CanDelete)
                    {
                        <MudButton Variant="Variant.Outlined"
                                   Color="Color.Error"
                                   StartIcon="@Icons.Material.Filled.Delete"
                                   OnClick="DeleteTeam"
                                   Disabled="@_isProcessing"
                                   Class="action-btn details-action-btn">
                            Delete
                        </MudButton>
                    }

                    <MudButton Variant="Variant.Text"
                               Color="Color.Secondary"
                               StartIcon="@Icons.Material.Filled.ArrowBack"
                               OnClick="@(() => NavigationManager.NavigateTo("/teams"))"
                               Class="action-btn details-action-btn back-action-btn">
                        Back
                    </MudButton>
                </div>
            </div>

            <div class="team-info-row">
                <MudText Typo="Typo.h3" Class="team-name">@_team.Name</MudText>
                <MudChip T="string"
                         Color="@(_team.IsActive ? Color.Success : Color.Error)"
                         Size="Size.Small"
                         Class="status-chip">
                    @(_team.IsActive ? "Active" : "Inactive")
                </MudChip>
            </div>

            <MudDivider Class="my-4" />

            <MudExpansionPanels Elevation="0" Class="expansion-panels">
                <MudExpansionPanel IsInitiallyExpanded="true" Class="expansion-panel">
                    <TitleContent>
                        <div class="panel-title">
                            <MudIcon Icon="@Icons.Material.Filled.Info" Class="panel-icon" />
                            <MudText Typo="Typo.h6">Basic Information</MudText>
                        </div>
                    </TitleContent>
                    <ChildContent>
                        <div class="info-grid">
                            <div class="info-row">
                                <div class="info-item">
                                    <MudText Class="info-label">Team Name</MudText>
                                    <MudText Class="info-value">@_team.Name</MudText>
                                </div>
                                <div class="info-item">
                                    <MudText Class="info-label">Club</MudText>
                                    <MudText Class="info-value">@(_team.ClubName ?? "N/A")</MudText>
                                </div>
                                <div class="info-item">
                                    <MudText Class="info-label">Age Category</MudText>
                                    <MudText Class="info-value">@(_team.AgeCategoryName ?? "N/A")</MudText>
                                </div>
                            </div>
                            <div class="info-row">
                                <div class="info-item">
                                    <MudText Class="info-label">Gender</MudText>
                                    <MudText Class="info-value">
                                        @(_team.Gender == HRKošarka.UI.Services.Base.Gender._0 ? "Male" : "Female")
                                    </MudText>
                                </div>
                                <div class="info-item">
                                    <MudText Class="info-label">Status</MudText>
                                    <MudText Class="info-value" Color="@(_team.IsActive ? Color.Success : Color.Error)">
                                        @(_team.IsActive
                                            ? "Active"
                                            : $"Deactivated on {_team.DeactivateDate?.ToString("dd/MM/yyyy")}")
                                    </MudText>
                                </div>
                            </div>
                        </div>
                    </ChildContent>
                </MudExpansionPanel>
            </MudExpansionPanels>
        </MudPaper>
    }
    else
    {
        <div class="error-state">
            <MudIcon Icon="@Icons.Material.Filled.ErrorOutline" Size="Size.Large" Color="Color.Error" />
            <MudText Typo="Typo.h5" Color="Color.Error">Team Not Found</MudText>
            <MudText Typo="Typo.body1">The team you're looking for doesn't exist or has been removed.</MudText>
            <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.ArrowBack"
                       OnClick="@(() => NavigationManager.NavigateTo("/teams"))">
                Back to Teams
            </MudButton>
        </div>
    }
</MudContainer>

<ConfirmActionDialog Visible="_showDeactivateDialog"
                     VisibleChanged="v => _showDeactivateDialog = v"
                     Title="Confirm Deactivation"
                     TitleIcon="@Icons.Material.Filled.PauseCircle"
                     TitleIconColor="Color.Warning"
                     Message="@(DeactivateMessage)"
                     SecondaryMessage="This action can be reversed later."
                     SecondaryMessageColor="Color.Warning"
                     CancelText="CANCEL"
                     CancelVariant="Variant.Outlined"
                     ConfirmText="DEACTIVATE"
                     ConfirmIcon="@Icons.Material.Filled.Pause"
                     ConfirmColor="Color.Warning"
                     ConfirmVariant="Variant.Filled"
                     IsProcessing="_isProcessing"
                     OnConfirm="ConfirmDeactivate"
                     Options="_dialogOptions" />

<ConfirmActionDialog Visible="_showActivateDialog"
                     VisibleChanged="v => _showActivateDialog = v"
                     Title="Confirm Activation"
                     TitleIcon="@Icons.Material.Filled.PlayCircle"
                     TitleIconColor="Color.Success"
                     Message="@(ActivateMessage)"
                     SecondaryMessage="This action will make the team active again."
                     SecondaryMessageColor="Color.Success"
                     CancelText="CANCEL"
                     CancelVariant="Variant.Outlined"
                     ConfirmText="ACTIVATE"
                     ConfirmIcon="@Icons.Material.Filled.PlayArrow"
                     ConfirmColor="Color.Success"
                     ConfirmVariant="Variant.Filled"
                     IsProcessing="_isProcessing"
                     OnConfirm="ConfirmActivate"
                     Options="_dialogOptions" />

<ConfirmActionDialog Visible="_showDeleteDialog"
                     VisibleChanged="v => _showDeleteDialog = v"
                     Title="Confirm Deletion"
                     TitleIcon="@Icons.Material.Filled.Warning"
                     TitleIconColor="Color.Error"
                     Message="@(DeleteMessage)"
                     SecondaryMessage="This action cannot be undone!"
                     SecondaryMessageColor="Color.Error"
                     CancelText="CANCEL"
                     CancelVariant="Variant.Outlined"
                     ConfirmText="DELETE"
                     ConfirmIcon="@Icons.Material.Filled.Delete"
                     ConfirmColor="Color.Error"
                     ConfirmVariant="Variant.Filled"
                     IsProcessing="_isProcessing"
                     OnConfirm="ConfirmDelete"
                     Options="_dialogOptions" />

<MudDialog @bind-Visible="_showRenameDialog"
           Options="_dialogOptions"
           Class="confirm-action-dialog">
    <DialogContent>
        <div class="confirm-dialog-content">
            <div class="confirm-dialog-title-row">
                <MudIcon Icon="@Icons.Material.Filled.Edit"
                         Color="Color.Primary"
                         Size="Size.Medium"
                         Class="confirm-dialog-title-icon" />
                <MudText Typo="Typo.h6" Class="confirm-dialog-title-text">
                    Rename Team
                </MudText>
            </div>

            <MudText Typo="Typo.body2" Class="confirm-dialog-message">
                Current name: <strong>@_team?.Name</strong>
            </MudText>

            <MudTextField @bind-Value="_newTeamName"
                          Label="New team name"
                          Variant="Variant.Outlined"
                          Required="true"
                          RequiredError="Name is required"
                          MaxLength="150"
                          Counter="150"
                          Class="w-100" />
        </div>
    </DialogContent>

    <DialogActions>
        <div class="confirm-dialog-actions">
            <MudButton OnClick="@(() => _showRenameDialog = false)"
                       Color="Color.Default"
                       Variant="Variant.Outlined"
                       Size="Size.Medium"
                       Class="confirm-dialog-btn">
                CANCEL
            </MudButton>

            <MudButton OnClick="ConfirmRename"
                       Color="Color.Primary"
                       Variant="Variant.Filled"
                       Size="Size.Medium"
                       StartIcon="@Icons.Material.Filled.Save"
                       Disabled="_isRenaming || string.IsNullOrWhiteSpace(_newTeamName)"
                       Class="confirm-dialog-btn">
                @if (_isRenaming)
                {
                    <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="mr-2" />
                }
                <MudText>SAVE</MudText>
            </MudButton>
        </div>
    </DialogActions>
</MudDialog>
