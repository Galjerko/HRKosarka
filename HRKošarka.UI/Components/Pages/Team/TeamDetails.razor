@page "/teams/{id:guid}"
@using MudBlazor
@using HRKošarka.UI.Services.Base

<PageTitle>Team Details - Basketball Management</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="details-container">
    @if (_isLoading)
    {
        <div class="loading-state">
            <MudProgressCircular Size="Size.Large" Indeterminate="true" />
            <MudText Typo="Typo.h6">Loading team details...</MudText>
        </div>
    }
    else if (_team != null)
    {
        <MudPaper Class="details-paper" Elevation="2">
            <!-- Action row, same as ClubDetails -->
            <div class="details-actions-row">
                <div class="details-actions-group">
                    <AuditHistory DateCreated="@_team.DateCreated"
                                  DateModified="@_team.DateModified"
                                  DateDeleted="@_team.DateDeleted"
                                  CreatedBy="@_team.CreatedBy"
                                  ModifiedBy="@_team.ModifiedBy"
                                  DeletedBy="@_team.DeletedBy" />

                    <AuthorizeView Roles="Administrator,ClubManager">
                        <Authorized>
                            <MudButton Variant="Variant.Outlined"
                                       Color="Color.Primary"
                                       StartIcon="@Icons.Material.Filled.Edit"
                                       OnClick="@(() => NavigationManager.NavigateTo($"/teams/edit/{Id}"))"
                                       Class="action-btn details-action-btn">
                                Edit
                            </MudButton>
                            @if (_team.IsActive)
                            {
                                <MudButton Variant="Variant.Outlined"
                                           Color="Color.Warning"
                                           StartIcon="@Icons.Material.Filled.Pause"
                                           OnClick="DeactivateTeam"
                                           Disabled="@_isProcessing"
                                           Class="action-btn details-action-btn">
                                    Deactivate
                                </MudButton>
                            }
                        </Authorized>
                    </AuthorizeView>
                    <AuthorizeView Roles="Administrator">
                        <Authorized>
                            <MudButton Variant="Variant.Outlined"
                                       Color="Color.Error"
                                       StartIcon="@Icons.Material.Filled.Delete"
                                       OnClick="DeleteTeam"
                                       Disabled="@_isProcessing"
                                       Class="action-btn details-action-btn">
                                Delete
                            </MudButton>
                        </Authorized>
                    </AuthorizeView>
                    <MudButton Variant="Variant.Text"
                               Color="Color.Secondary"
                               StartIcon="@Icons.Material.Filled.ArrowBack"
                               OnClick="@(() => NavigationManager.NavigateTo("/teams"))"
                               Class="action-btn details-action-btn back-action-btn">
                        Back
                    </MudButton>
                </div>
            </div>

            <div class="team-info-row">
                <MudText Typo="Typo.h3" Class="team-name">@_team.Name</MudText>
                <MudChip T="string"
                         Color="@(_team.IsActive ? Color.Success : Color.Error)"
                         Size="Size.Small"
                         Class="status-chip">
                    @(_team.IsActive ? "Active" : "Inactive")
                </MudChip>
            </div>

            <MudDivider Class="my-4" />

            <MudExpansionPanels Elevation="0" Class="expansion-panels">
                <MudExpansionPanel IsInitiallyExpanded="true" Class="expansion-panel">
                    <TitleContent>
                        <div class="panel-title">
                            <MudIcon Icon="@Icons.Material.Filled.Info" Class="panel-icon" />
                            <MudText Typo="Typo.h6">Basic Information</MudText>
                        </div>
                    </TitleContent>
                    <ChildContent>
                        <div class="info-grid">
                            <div class="info-row">
                                <div class="info-item">
                                    <MudText Class="info-label">Team Name</MudText>
                                    <MudText Class="info-value">@_team.Name</MudText>
                                </div>
                                <div class="info-item">
                                    <MudText Class="info-label">Club</MudText>
                                    <MudText Class="info-value">@(_team.ClubName ?? "N/A")</MudText>
                                </div>
                                <div class="info-item">
                                    <MudText Class="info-label">Age Category</MudText>
                                    <MudText Class="info-value">@(_team.AgeCategoryName ?? "N/A")</MudText>
                                </div>
                            </div>
                            <div class="info-row">
                                <div class="info-item">
                                    <MudText Class="info-label">Gender</MudText>
                                    <MudText Class="info-value">
                                        @(_team.Gender == Gender._0 ? "Male" : "Female")
                                    </MudText>
                                </div>
                                <div class="info-item">
                                    <MudText Class="info-label">Status</MudText>
                                    <MudText Class="info-value" Color="@(_team.IsActive ? Color.Success : Color.Error)">
                                        @(_team.IsActive
                                            ? "Active"
                                            : $"Deactivated on {_team.DeactivateDate?.ToString("dd/MM/yyyy")}")
                                    </MudText>
                                </div>
                            </div>
                        </div>
                    </ChildContent>
                </MudExpansionPanel>
                @* ADD FURTHER PANELS HERE if you have related entities (players, matches, etc) *@
            </MudExpansionPanels>
        </MudPaper>
    }
    else
    {
        <div class="error-state">
            <MudIcon Icon="@Icons.Material.Filled.ErrorOutline" Size="Size.Large" Color="Color.Error" />
            <MudText Typo="Typo.h5" Color="Color.Error">Team Not Found</MudText>
            <MudText Typo="Typo.body1">The team you're looking for doesn't exist or has been removed.</MudText>
            <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.ArrowBack"
                       OnClick="@(() => NavigationManager.NavigateTo("/teams"))">
                Back to Teams
            </MudButton>
        </div>
    }
</MudContainer>

<MudDialog @bind-Visible="_showDeactivateDialog" Options="_dialogOptions">
    <DialogContent>
        <MudText Typo="Typo.h6" Class="mb-4">Confirm Deactivation</MudText>
        <MudText>Are you sure you want to deactivate <strong>@_team?.Name</strong>?</MudText>
        <MudText Class="mt-2" Color="Color.Warning">This action can be reversed later.</MudText>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="@(() => _showDeactivateDialog = false)">Cancel</MudButton>
        <MudButton Color="Color.Warning" Variant="Variant.Filled" OnClick="ConfirmDeactivate" Disabled="@_isProcessing">
            @_isProcessing ? <MudProgressCircular Size="Size.Small" Indeterminate="true" /> : <MudText>Deactivate</MudText>
        </MudButton>
    </DialogActions>
</MudDialog>

<MudDialog @bind-Visible="_showDeleteDialog" Options="_dialogOptions">
    <DialogContent>
        <MudText Typo="Typo.h6" Class="mb-4">Confirm Deletion</MudText>
        <MudText>Are you sure you want to permanently delete <strong>@_team?.Name</strong>?</MudText>
        <MudText Class="mt-2" Color="Color.Error">This action cannot be undone!</MudText>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="@(() => _showDeleteDialog = false)">Cancel</MudButton>
        <MudButton Color="Color.Error" Variant="Variant.Filled" OnClick="ConfirmDelete" Disabled="@_isProcessing">
            @_isProcessing ? <MudProgressCircular Size="Size.Small" Indeterminate="true" /> : <MudText>Delete</MudText>
        </MudButton>
    </DialogActions>
</MudDialog>
